{"version":3,"sources":["../src/utils.js"],"names":["Cu","Components","utils","import","ALLOWED_BINARY_TYPES","getServerUrlBrowser","url","scheme","port","test","window","location","protocol","hostname","getServerUrlNode","getWebSocket","protocols","ws","WebSocket","MozWebSocket","EXPORTED_SYMBOLS"],"mappings":";;AAAA,IAAMA,KAAKC,WAAWC,KAAtB;;iBACiCF,GAAGG,MAAH,CAAU,sCAAV,EAAkD,EAAlD,C;IAAzBC,oB,cAAAA,oB;;AAER,SAASC,mBAAT,CAA8BC,GAA9B,EAAmC;AAC/B,QAAIC,eAAJ;AAAA,QAAYC,aAAZ;;AAEA,QAAI,eAAeC,IAAf,CAAoBH,GAApB,CAAJ,EAA8B;AAAI;AAC9B,eAAOA,GAAP;AACH;;AAEDC,aAASG,OAAOC,QAAP,CAAgBC,QAAhB,KAA6B,QAA7B,GAAwC,QAAxC,GAAmD,OAA5D;;AAEA,QAAI,CAACN,GAAL,EAAU;AACNE,eAAOE,OAAOC,QAAP,CAAgBH,IAAhB,KAAyB,EAAzB,GAA8B,MAAME,OAAOC,QAAP,CAAgBH,IAApD,GAA2D,EAAlE;AACA,eAAOD,SAASG,OAAOC,QAAP,CAAgBE,QAAzB,GAAoCL,IAApC,GAA2C,KAAlD;AACH,KAHD,MAGO,IAAIF,IAAI,CAAJ,MAAW,GAAf,EAAoB;AAAK;AAC5BE,eAAOE,OAAOC,QAAP,CAAgBH,IAAhB,KAAyB,EAAzB,GAA8B,MAAME,OAAOC,QAAP,CAAgBH,IAApD,GAA2D,EAAlE;AACA,eAAOD,SAASG,OAAOC,QAAP,CAAgBE,QAAzB,GAAoCL,IAApC,GAA2CF,GAAlD;AACH,KAHM,MAGA;AAAK;AACR,eAAOC,SAASD,GAAhB;AACH;AACJ;;AAED,SAASQ,gBAAT,CAA2BR,GAA3B,EAAgC;AAC5B,QAAI,eAAeG,IAAf,CAAoBH,GAApB,CAAJ,EAA8B;AAAI;AAC9B,eAAOA,GAAP;AACH,KAFD,MAEO;AACH,eAAO,IAAP;AACH;AACJ;;AAED,SAASS,YAAT,CAAuBT,GAAvB,EAA4BU,SAA5B,EAAuCC,EAAvC,EAA2C;AACvC,QAAIA,EAAJ,EAAQ;AAAI;AACR,eAAO,IAAIA,EAAJ,CAAOX,GAAP,EAAYU,SAAZ,CAAP;AACH,KAFD,MAEO,IAAI,eAAeN,MAAnB,EAA2B;AAC9B;AACA,eAAO,IAAIA,OAAOQ,SAAX,CAAqBZ,GAArB,EAA0BU,SAA1B,CAAP;AACH,KAHM,MAGA,IAAI,kBAAkBN,MAAtB,EAA8B;AACjC;AACA,eAAO,IAAIA,OAAOS,YAAX,CAAwBb,GAAxB,EAA6BU,SAA7B,CAAP;AACH;;AAED,WAAO,IAAP;AACH;;AAED,IAAMI,mBAAmB,CAAC,cAAD,CAAzB","file":"utils.js","sourcesContent":["const Cu = Components.utils;\nconst { ALLOWED_BINARY_TYPES } = Cu.import('resource://getbot/wampy/constants.js', {});\n\nfunction getServerUrlBrowser (url) {\n    let scheme, port;\n\n    if (/^ws(s)?:\\/\\//.test(url)) {   // ws scheme is specified\n        return url;\n    }\n\n    scheme = window.location.protocol === 'https:' ? 'wss://' : 'ws://';\n\n    if (!url) {\n        port = window.location.port !== '' ? ':' + window.location.port : '';\n        return scheme + window.location.hostname + port + '/ws';\n    } else if (url[0] === '/') {    // just path on current server\n        port = window.location.port !== '' ? ':' + window.location.port : '';\n        return scheme + window.location.hostname + port + url;\n    } else {    // assuming just domain+path\n        return scheme + url;\n    }\n}\n\nfunction getServerUrlNode (url) {\n    if (/^ws(s)?:\\/\\//.test(url)) {   // ws scheme is specified\n        return url;\n    } else {\n        return null;\n    }\n}\n\nfunction getWebSocket (url, protocols, ws) {\n    if (ws) {   // User provided webSocket class\n        return new ws(url, protocols);\n    } else if ('WebSocket' in window) {\n        // Chrome, MSIE, newer Firefox\n        return new window.WebSocket(url, protocols);\n    } else if ('MozWebSocket' in window) {\n        // older versions of Firefox\n        return new window.MozWebSocket(url, protocols);\n    }\n\n    return null;\n}\n\nconst EXPORTED_SYMBOLS = ['getWebSocket'];\n"]}